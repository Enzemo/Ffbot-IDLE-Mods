<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enzemo // Game Command</title>
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --border: #30363d;
            --accent: #58a6ff; --text: #c9d1d9; --muted: #8b949e;
            --success: #3fb950; --warning: #d29922; --danger: #f85149;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .dashboard { display: grid; grid-template-columns: 320px 1fr; gap: 20px; max-width: 1300px; margin: 0 auto; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        h2 { font-size: 1.1rem; color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-top: 0; }
        h3 { font-size: 0.8rem; color: var(--muted); text-transform: uppercase; margin: 15px 0 10px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 6px; }
        .label { display: block; font-size: 0.7rem; color: var(--muted); }
        .val { font-weight: bold; font-family: monospace; }
        .bar { height: 8px; background: #21262d; border-radius: 4px; overflow: hidden; margin: 8px 0; }
        .fill { height: 100%; background: var(--accent); width: 0%; transition: width 1s; }
        .passive-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #21262d; }
        .badge { padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: bold; background: #21262d; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { text-align: left; color: var(--muted); padding: 8px; border-bottom: 1px solid var(--border); }
        td { padding: 8px; border-bottom: 1px solid #21262d; }
    </style>
</head>
<body>

<div class="dashboard">
    <aside>
        <section class="card">
            <h2 id="p-name">Loading...</h2>
            <div class="stat-grid">
                <div class="stat-box"><span class="label">Unit</span><span id="p-unit" class="val">-</span></div>
                <div class="stat-box"><span class="label">Level</span><span id="p-lvl" class="val">-</span></div>
            </div>
            <h3>Core Stats</h3>
            <div class="stat-grid">
                <div class="stat-box"><span class="label">HP</span><span id="p-hp" class="val">-</span></div>
                <div class="stat-box"><span class="label">ATK</span><span id="p-atk" class="val">-</span></div>
                <div class="stat-box"><span class="label">MAG</span><span id="p-mag" class="val">-</span></div>
                <div class="stat-box"><span class="label">SPR</span><span id="p-spr" class="val">-</span></div>
            </div>
            <h3>Collection</h3>
            <div class="bar"><div id="col-fill" class="fill"></div></div>
            <div style="font-size: 0.75rem; text-align: right;" id="col-text">0 / 0</div>
        </section>
    </aside>

    <main>
        <section class="card">
            <h2>Live Battle: vs <span id="g-boss">-</span></h2>
            <div class="stat-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div class="stat-box"><span class="label">Stage</span><span id="g-stage" class="val">-</span></div>
                <div class="stat-box"><span class="label">Wave</span><span id="g-wave" class="val">-</span></div>
                <div class="stat-box"><span class="label">Time</span><span id="g-time" class="val">-</span></div>
            </div>
            <div class="bar" style="margin-top:20px;"><div id="wave-fill" class="fill"></div></div>
        </section>

        <section class="card">
            <h2>Passive Unlock Milestones</h2>
            <div id="passives-list"></div>
        </section>

        <section class="card">
            <h2>Current Party</h2>
            <table>
                <thead><tr><th>Name</th><th>Unit</th><th>Current HP</th><th>ATB</th><th>Passive</th></tr></thead>
                <tbody id="party-list"></tbody>
            </table>
        </section>
    </main>
</div>

<script>
async function loadDashboard() {
    try {
        const [pRes, gRes] = await Promise.all([fetch('player_stats.json'), fetch('game_stats.json')]);
        const p = await pRes.json();
        const g = await gRes.json();

        // Player Section
        document.getElementById('p-name').textContent = p.player_name;
        document.getElementById('p-unit').textContent = p.character_info.unit;
        document.getElementById('p-lvl').textContent = p.basic_stats.level;
        document.getElementById('p-hp').textContent = p.basic_stats.hp;
        document.getElementById('p-atk').textContent = p.basic_stats.attack;
        document.getElementById('p-mag').textContent = p.basic_stats.magic;
        document.getElementById('p-spr').textContent = p.basic_stats.spirit;

        const cPerc = (p.collection.collected / p.collection.total) * 100;
        document.getElementById('col-fill').style.width = cPerc + '%';
        document.getElementById('col-text').textContent = `${p.collection.collected} / ${p.collection.total} Items`;

        // Game Section
        document.getElementById('g-boss').textContent = g.game_info.current_boss;
        document.getElementById('g-stage').textContent = g.game_info.stage;
        document.getElementById('g-wave').textContent = `${g.wave_info.current_wave}/${g.wave_info.max_waves}`;
        document.getElementById('g-time').textContent = g.battle_info.battle_time;
        document.getElementById('wave-fill').style.width = g.wave_info.wave_progress_percent + '%';

        // Passives Section
        const pList = document.getElementById('passives-list');
        p.passives.available_passives.forEach(item => {
            const prog = (p.basic_stats.wins / item.wins_required) * 100;
            pList.innerHTML += `
                <div class="passive-row">
                    <div style="flex:1">
                        <strong>Slot ${item.slot}: ${item.name}</strong>
                        <div class="bar" style="width: 80%; height: 4px;"><div class="fill" style="width:${prog}%"></div></div>
                    </div>
                    <div class="badge">${item.wins_until_unlock} wins remaining</div>
                </div>`;
        });

        // Party Section
        const party = document.getElementById('party-list');
        g.player_details.forEach(unit => {
            party.innerHTML += `
                <tr>
                    <td><strong>${unit.name}</strong></td>
                    <td>${unit.unit}</td>
                    <td style="color:var(--success)">${unit.hp_current} HP</td>
                    <td>${unit.atb}%</td>
                    <td><span class="badge">${unit.passive || 'None'}</span></td>
                </tr>`;
        });

    } catch (e) {
        console.error(e);
        document.body.innerHTML = `<div style="text-align:center; padding:50px;"><h2>Load Error</h2><p>Check that player_stats.json and game_stats.json are in this folder.</p></div>`;
    }
}
loadDashboard();
</script>
</body>
</html>
